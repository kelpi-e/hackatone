{% load static %}
<!DOCTYPE html>
<html lang="ru">
  <head>
    <title>CodeSphere - Редактор кода</title>
    <meta property="og:title" content="CodeSphere - Редактор кода" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta charset="utf-8" />

    <style data-tag="reset-style-sheet">
      html {  line-height: 1.15;}body {  margin: 0;}* {  box-sizing: border-box;  border-width: 0;  border-style: solid;  -webkit-font-smoothing: antialiased;}p,li,ul,pre,div,h1,h2,h3,h4,h5,h6,figure,blockquote,figcaption {  margin: 0;  padding: 0;}button {  background-color: transparent;}button,input,optgroup,select,textarea {  font-family: inherit;  font-size: 100%;  line-height: 1.15;  margin: 0;}button,select {  text-transform: none;}button,[type="button"],[type="reset"],[type="submit"] {  -webkit-appearance: button;  color: inherit;}button::-moz-focus-inner,[type="button"]::-moz-focus-inner,[type="reset"]::-moz-focus-inner,[type="submit"]::-moz-focus-inner {  border-style: none;  padding: 0;}button:-moz-focus,[type="button"]:-moz-focus,[type="reset"]:-moz-focus,[type="submit"]:-moz-focus {  outline: 1px dotted ButtonText;}a {  color: inherit;  text-decoration: inherit;}pre {  white-space: normal;}input {  padding: 2px 4px;}img {  display: block;}details {  display: block;  margin: 0;  padding: 0;}summary::-webkit-details-marker {  display: none;}[data-thq="accordion"] [data-thq="accordion-content"] {  max-height: 0;  overflow: hidden;  transition: max-height 0.3s ease-in-out;  padding: 0;}[data-thq="accordion"] details[data-thq="accordion-trigger"][open] + [data-thq="accordion-content"] {  max-height: 1000vh;}details[data-thq="accordion-trigger"][open] summary [data-thq="accordion-icon"] {  transform: rotate(180deg);}html { scroll-behavior: smooth  }
    </style>
    <style data-tag="default-style-sheet">
      html {
        font-family: "Roboto Mono";
        font-size: 1rem;
      }

      body {
        font-weight: 400;
        font-style:normal;
        text-decoration: undefined;
        text-transform: undefined;
        letter-spacing: 0.01em;
        line-height: 1.6;
        color: var(--color-on-surface);
        background: var(--color-surface);
        fill: var(--color-on-surface);
      }
    </style>
    <link rel="stylesheet" href="https://unpkg.com/animate.css@4.1.1/animate.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=STIX+Two+Text:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&display=swap" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700&display=swap" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Rubik:ital,wght@0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" />
    <link rel="stylesheet" href="https://unpkg.com/@teleporthq/teleport-custom-scripts/dist/style.css" />
    
    <!-- CodeMirror -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/theme/eclipse.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/hint/show-hint.min.css">
    
    <link rel="stylesheet" href="{% static 'style.css' %}" />
    <link href="{% static 'index.css' %}" rel="stylesheet" />
    <link href="{% static 'components/navigation.css' %}" rel="stylesheet" />
    <link href="{% static 'components/footer.css' %}" rel="stylesheet" />
    
    <style>
      .editor-section {
        min-height: calc(100vh - 200px);
        padding: 40px 20px;
        background: var(--color-surface);
      }
      
      .editor-container {
        max-width: 1400px;
        margin: 0 auto;
      }
      
      .editor-layout {
        display: grid;
        grid-template-columns: 1fr 5px 1fr;
        gap: 20px;
        height: calc(100vh - 300px);
        margin-top: 20px;
      }
      
      .editor-panel {
        display: flex;
        flex-direction: column;
        background: #ffffff;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(0, 0, 0, 0.1);
      }
      
      .panel-header {
        padding: 15px 20px;
        background: #f8f9fa;
        border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        display: flex;
        align-items: center;
        gap: 10px;
      }
      
      .panel-title {
        font-weight: 600;
        color: #212529;
      }
      
      .task-selector {
        padding: 15px 20px;
        background: #f8f9fa;
        border-bottom: 1px solid rgba(0, 0, 0, 0.1);
      }
      
      .task-selector label {
        display: block;
        margin-bottom: 10px;
        font-weight: 600;
        color: #212529;
      }
      
      .task-selector select {
        width: 100%;
        padding: 10px;
        border-radius: 8px;
        background: #ffffff;
        color: #212529;
        border: 1px solid rgba(0, 0, 0, 0.2);
        font-family: inherit;
      }
      
      .task-description {
        padding: 20px;
        background: #ffffff;
        border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        max-height: 200px;
        overflow-y: auto;
        color: #212529;
        line-height: 1.6;
        white-space: pre-wrap;
        font-family: 'Roboto Mono', monospace;
      }
      
      .code-editor-wrapper {
        flex: 1;
        display: flex;
        flex-direction: column;
        min-height: 0;
      }
      
      .CodeMirror {
        flex: 1;
        height: 100%;
        font-size: 16px;
        font-family: 'Roboto Mono', monospace;
        background: #ffffff;
        color: #212529;
      }
      
      .CodeMirror-hints {
        background: #ffffff;
        border: 1px solid rgba(0, 0, 0, 0.2);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      }
      
      .CodeMirror-hint {
        color: #212529;
      }
      
      .CodeMirror-hint-active {
        background: #e9ecef;
      }
      
      .code-actions {
        padding: 15px 20px;
        background: #f8f9fa;
        border-top: 1px solid rgba(0, 0, 0, 0.1);
      }
      
      .resizer {
        width: 5px;
        background: #dee2e6;
        cursor: col-resize;
        transition: background 0.2s;
      }
      
      .resizer:hover {
        background: #adb5bd;
      }
      
      .output-panel {
        display: flex;
        flex-direction: column;
      }
      
      .output-content {
        flex: 1;
        padding: 20px;
        overflow-y: auto;
        background: #ffffff;
        color: #212529;
        font-family: 'Roboto Mono', monospace;
        font-size: 14px;
        line-height: 1.6;
        white-space: pre-wrap;
      }
      
      .output-content pre {
        margin: 0;
        white-space: pre-wrap;
        word-wrap: break-word;
      }
      
      .btn-run {
        background: var(--dls-color-accent-primary, #ff6600);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        font-size: 16px;
      }
      
      .btn-run:hover {
        background: var(--dls-color-accent-primary-hover, #ff8533);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(255, 102, 0, 0.3);
      }
      
      @media (max-width: 768px) {
        .editor-layout {
          grid-template-columns: 1fr;
          grid-template-rows: 1fr 5px 1fr;
          height: auto;
        }
        
        .resizer {
          width: 100%;
          height: 5px;
          cursor: row-resize;
        }
      }
    </style>
  </head>
  <body>
    <div class="home-container1">
      <!-- Navigation -->
      <navigation-wrapper class="navigation-wrapper">
        <div class="navigation-container1">
          <nav id="mainNavigation" class="navigation">
            <div class="navigation-container">
              <div class="navigation-left">
                <a href="{% url 'home' %}">
                  <div class="navigation-link"><span>Главная</span></div>
                </a>
                <a href="{% url 'index' %}">
                  <div class="navigation-link"><span>Редактор</span></div>
                </a>
              </div>
              <a href="{% url 'home' %}">
                <div class="navigation-logo">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="navigation-logo-icon">
                    <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m16 18l6-6l-6-6M8 6l-6 6l6 6"></path>
                  </svg>
                  <span class="navigation-logo-text">CodeSphere</span>
                </div>
              </a>
              <div class="navigation-right">
                <a href="{% url 'index' %}">
                  <div class="navigation-cta btn btn-primary">
                    <span>Начать кодить</span>
                  </div>
                </a>
              </div>
              <button id="navToggle" aria-expanded="false" aria-label="Открыть меню навигации" class="navigation-toggle">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                  <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 5h16M4 12h16M4 19h16"></path>
                </svg>
              </button>
            </div>
          </nav>
          <div id="navMobileOverlay" class="navigation-mobile-overlay">
            <div class="navigation-mobile-header">
              <a href="{% url 'home' %}">
                <div class="navigation-mobile-logo">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="navigation-mobile-logo-icon">
                    <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m16 18l6-6l-6-6M8 6l-6 6l6 6"></path>
                  </svg>
                  <span class="navigation-mobile-logo-text">CodeSphere</span>
                </div>
              </a>
              <button id="navClose" aria-label="Закрыть меню навигации" class="navigation-close">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                  <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 6L6 18M6 6l12 12"></path>
                </svg>
              </button>
            </div>
            <div class="navigation-mobile-content">
              <a href="{% url 'home' %}">
                <div class="navigation-mobile-link"><span>Главная</span></div>
              </a>
              <a href="{% url 'index' %}">
                <div class="navigation-mobile-link"><span>Редактор</span></div>
              </a>
              <a href="{% url 'index' %}">
                <div class="navigation-mobile-cta btn btn-primary"><span>Начать кодить</span></div>
              </a>
            </div>
          </div>
          <div class="navigation-container2">
            <div class="navigation-container3">
              <script defer="" data-name="navigation-toggle">
                document.addEventListener('DOMContentLoaded', function() {
                  (function(){
                    const navToggle = document.getElementById("navToggle")
                    const navClose = document.getElementById("navClose")
                    const navMobileOverlay = document.getElementById("navMobileOverlay")

                    function openMobileNav() {
                      navMobileOverlay.classList.add("navigation-mobile-active")
                      navToggle.setAttribute("aria-expanded", "true")
                      document.body.style.overflow = "hidden"
                    }

                    function closeMobileNav() {
                      navMobileOverlay.classList.remove("navigation-mobile-active")
                      navToggle.setAttribute("aria-expanded", "false")
                      document.body.style.overflow = ""
                    }

                    navToggle.addEventListener("click", openMobileNav)
                    navClose.addEventListener("click", closeMobileNav)

                    const mobileLinks = document.querySelectorAll(".navigation-mobile-link, .navigation-mobile-cta")
                    mobileLinks.forEach((link) => {
                      link.addEventListener("click", closeMobileNav)
                    })
                  })()
                });
              </script>
            </div>
          </div>
        </div>
      </navigation-wrapper>

      <!-- Editor Section -->
      <section class="editor-section">
        <div class="editor-container">
          <h2 class="section-title" style="text-align: center; margin-bottom: 10px;">Интерактивный редактор кода</h2>
          <p class="section-subtitle" style="text-align: center; margin-bottom: 30px;">Напишите код, запустите его и получите результат</p>
          
          <div class="editor-layout">
            <div class="editor-panel" id="left">
              <div class="task-selector">
                <label for="task-select"><strong>Выберите задачу:</strong></label>
                <form method="get" id="task-form">
                  <select id="task-select" name="task" onchange="this.form.submit()">
                    {% for task_file in tasks %}
                      <option value="{{ task_file }}" {% if task_file == selected_task %}selected{% endif %}>{{ task_file }}</option>
                    {% endfor %}
                  </select>
                </form>
              </div>
              
              {% if task_text %}
              <div class="task-description">{{ task_text }}</div>
              {% endif %}
              
              <div class="code-editor-wrapper">
                <form method="post" action="{% url 'run_code' %}" id="code-form">
                  {% csrf_token %}
                  <input type="hidden" name="task" value="{{ selected_task }}">
                  <textarea id="code" name="code">{{ code|default:"" }}</textarea>
                </form>
              </div>
              
              <div class="code-actions">
                <button type="submit" form="code-form" class="btn-run">▶ Запустить код</button>
              </div>
            </div>

            <div class="resizer" id="resizer"></div>

            <div class="editor-panel output-panel" id="right">
              <div class="panel-header">
                <span class="panel-title">Вывод</span>
              </div>
              <div class="output-content" id="output">
                <pre>{% if output %}{{ output }}{% else %}Запустите код, чтобы увидеть результат...{% endif %}</pre>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Footer -->
      <footer-wrapper class="footer-wrapper">
        <div class="footer-container1">
          <footer class="footer">
            <div class="footer-wrapper">
              <div class="footer-content">
                <div class="footer-newsletter-section">
                  <div class="footer-newsletter-header">
                    <div class="footer-logo-container">
                      <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="footer-logo-icon">
                        <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m16 18l6-6l-6-6M8 6l-6 6l6 6"></path>
                      </svg>
                      <span class="footer-logo-text">CodeSphere</span>
                    </div>
                    <p class="footer-newsletter-description">
                      Получайте обновления о новых возможностях платформы, советы по программированию и эксклюзивные материалы
                    </p>
                  </div>
                </div>
                <div class="footer-divider"></div>
                <div class="footer-info-grid">
                  <div class="footer-column footer-column-brand">
                    <div class="footer-brand-content">
                      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="footer-terminal-icon">
                        <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19h8M4 17l6-6l-6-6"></path>
                      </svg>
                      <p class="footer-brand-description">
                        Интерактивная платформа для изучения программирования с встроенной IDE, автоматической проверкой кода и изолированным выполнением в контейнерах
                      </p>
                    </div>
                  </div>
                  <div class="footer-column">
                    <h3 class="footer-column-title">Платформа</h3>
                    <ul class="footer-link-list">
                      <li class="footer-link-item">
                        <a href="{% url 'home' %}">
                          <div class="footer-link"><span>Главная</span></div>
                        </a>
                      </li>
                      <li class="footer-link-item">
                        <a href="{% url 'index' %}">
                          <div class="footer-link"><span>Редактор</span></div>
                        </a>
                      </li>
                    </ul>
                  </div>
                </div>
                <div class="footer-divider"></div>
                <div class="footer-bottom">
                  <p class="footer-copyright">© 2025 CodeSphere. Все права защищены</p>
                </div>
              </div>
            </div>
          </footer>
        </div>
      </footer-wrapper>
    </div>

    <!-- CodeMirror Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/python/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/hint/show-hint.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/hint/anyword-hint.min.js"></script>

    <script>
      // Initialize CodeMirror
      var editor = CodeMirror.fromTextArea(document.getElementById('code'), {
        mode: "python",
        lineNumbers: true,
        indentUnit: 4,
        theme: "eclipse",
        viewportMargin: Infinity,
        extraKeys: {"Ctrl-Space": "autocomplete"},
        lineWrapping: true
      });

      editor.on("inputRead", function(cm, change) {
        if (change.text[0].match(/\w/)) {
          CodeMirror.showHint(cm, CodeMirror.hint.anyword, {completeSingle: false});
        }
      });

      // Horizontal resizer
      const resizer = document.getElementById('resizer');
      const left = document.getElementById('left');
      const right = document.getElementById('right');
      let isResizing = false;

      resizer.addEventListener('mousedown', e => {
        isResizing = true;
        document.body.style.cursor = 'col-resize';
      });

      document.addEventListener('mousemove', e => {
        if (!isResizing) return;
        
        const containerRect = left.parentNode.getBoundingClientRect();
        let pointerX = e.clientX - containerRect.left;
        const minWidth = 200;
        const maxWidth = containerRect.width - minWidth - resizer.offsetWidth;
        
        if (pointerX < minWidth) pointerX = minWidth;
        if (pointerX > maxWidth) pointerX = maxWidth;
        
        left.style.flex = '0 0 ' + pointerX + 'px';
        right.style.flex = '1';
      });

      document.addEventListener('mouseup', e => {
        isResizing = false;
        document.body.style.cursor = '';
      });

      // Mobile responsive
      if (window.innerWidth <= 768) {
        resizer.style.cursor = 'row-resize';
        resizer.addEventListener('mousedown', e => {
          isResizing = true;
          document.body.style.cursor = 'row-resize';
        });
        
        document.addEventListener('mousemove', e => {
          if (!isResizing) return;
          
          const containerRect = left.parentNode.getBoundingClientRect();
          let pointerY = e.clientY - containerRect.top;
          const minHeight = 200;
          const maxHeight = containerRect.height - minHeight - resizer.offsetHeight;
          
          if (pointerY < minHeight) pointerY = minHeight;
          if (pointerY > maxHeight) pointerY = maxHeight;
          
          left.style.height = pointerY + 'px';
          right.style.flex = '1';
        });
      }
    </script>
  </body>
</html>
