<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Python Executor</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono&display=swap" rel="stylesheet">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/theme/material-darker.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/hint/show-hint.min.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/python/python.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/hint/show-hint.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/hint/anyword-hint.min.js"></script>

<style>
html, body {
    height: 100%;
    margin: 0;
    font-family: 'JetBrains Mono', monospace;
    font-size: 16px;
    background-color: #1e1e2f;
    color: #c0c0c0;
}
h1 {
    text-align: center;
    color: #ffcc00;
    margin: 10px 0;
}

.main-container {
    display: flex;
    height: calc(100vh - 50px);
    gap: 10px;
    padding: 0 10px 10px 10px;
    overflow: hidden;
}

.editor-column {
    display: flex;
    flex-direction: column;
    flex: 1;
}

.task-section {
    background-color: #2b2b3c;
    padding: 10px;
    border-radius: 8px;
    margin-bottom: 10px;
    font-weight: bold;
    line-height: 1.5;
    flex: 0 0 auto;
}

.code-output-container {
    display: flex;
    flex-direction: column;
    flex: 1;
    min-height: 0; /* для корректного растягивания */
}

.CodeMirror {
    flex: 1;
    border-radius: 8px;
    font-size: 18px;
    min-height: 200px;
}

.output {
    flex: 0 0 120px;
    min-height: 100px;
    background-color: #2b2b3c;
    padding: 10px;
    border-radius: 8px;
    overflow-y: auto;
    margin-top: 5px;
    font-size: 18px;
}

.vert-resizer {
    height: 5px;
    cursor: row-resize;
    background-color: #444;
    margin: 5px 0;
}

.chat-column {
    flex: 1;
    display: flex;
    flex-direction: column;
    background-color: #2b2b3c;
    border-radius: 8px;
    padding: 10px;
}

.chat-messages {
    flex: 1;
    background-color: #1e1e2f;
    border-radius: 5px;
    padding: 10px;
    overflow-y: auto;
}

.chat-input {
    margin-top: 10px;
    display: flex;
    gap: 5px;
}

.chat-input textarea {
    flex: 1;
    border-radius: 5px;
    padding: 5px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 14px;
    resize: none;
}

.chat-input button {
    flex: 0 0 80px;
}

button {
    margin-top: 10px;
    background-color: #ff6600;
    color: #fff;
    border: none;
    padding: 10px 20px;
    font-size: 16px;
    cursor: pointer;
    border-radius: 5px;
    transition: 0.3s;
}

button:hover {
    background-color: #ff8533;
}

.resizer {
    width: 5px;
    cursor: col-resize;
    background-color: #444;
}
</style>
</head>
<body>
<h1>Python Executor</h1>

<div class="main-container">
    <!-- Левая колонка: задача + код + вывод -->
    <div class="editor-column" id="left">
        <div class="task-section">
            <p><strong>Задача:</strong> Напишите функцию <code>sum_list(nums)</code>, которая возвращает сумму всех элементов списка целых чисел.</p>
            <p><strong>Ограничения:</strong></p>
            <ul>
                <li>1 ≤ длина списка ≤ 1000</li>
                <li>-10<sup>6</sup> ≤ элемент списка ≤ 10<sup>6</sup></li>
            </ul>
            <p><strong>Входные данные:</strong> список целых чисел <code>nums</code></p>
            <p><strong>Выходные данные:</strong> одно целое число — сумма элементов списка</p>
            <p><strong>Пример:</strong></p>
            <pre>Вход: [1,2,3,4]  Выход: 10</pre>
        </div>

        <div class="code-output-container">
            <form method="post" action="{% url 'run_code' %}">
                {% csrf_token %}
                <textarea id="code" name="code" rows="30">{{ code|default:"" }}</textarea>
                <button type="submit">Run</button>
            </form>

            <div class="vert-resizer" id="vert-resizer"></div>

            <div class="output" id="output"><pre>{{ output }}</pre></div>
        </div>
    </div>

    <!-- Ресайзер между колонками -->
    <div class="resizer" id="resizer"></div>

    <!-- Правая колонка: чат -->
    <div class="chat-column" id="right">
        <div class="chat-messages"></div>
        <div class="chat-input">
            <textarea rows="3" placeholder="Написать сообщение..."></textarea>
            <button>Отправить</button>
        </div>
    </div>
</div>

<script>
// CodeMirror
var editor = CodeMirror.fromTextArea(document.getElementById('code'), {
    mode: "python",
    lineNumbers: true,
    indentUnit: 4,
    theme: "material-darker",
    viewportMargin: Infinity,
    extraKeys: {"Ctrl-Space": "autocomplete"}
});

editor.on("inputRead", function(cm, change) {
    if (change.text[0].match(/\w/)) {
        CodeMirror.showHint(cm, CodeMirror.hint.anyword, {completeSingle: false});
    }
});

// Горизонтальный ресайзер
const resizer = document.getElementById('resizer');
const left = document.getElementById('left');
const right = document.getElementById('right');
let isResizing = false;
resizer.addEventListener('mousedown', e => { isResizing = true; document.body.style.cursor='col-resize'; });
document.addEventListener('mousemove', e => {
    if (!isResizing) return;
    let pointerX = e.clientX - left.parentNode.offsetLeft;
    let minWidth = 200;
    let maxWidth = left.parentNode.clientWidth - minWidth - resizer.offsetWidth;
    if(pointerX < minWidth) pointerX = minWidth;
    if(pointerX > maxWidth) pointerX = maxWidth;
    left.style.flex = '0 0 '+pointerX+'px';
    right.style.flex='1';
});
document.addEventListener('mouseup', e => { isResizing = false; document.body.style.cursor='default'; });

// Вертикальный ресайзер для кода/вывода
const vertResizer = document.getElementById('vert-resizer');
const codeContainer = document.querySelector('.CodeMirror');
const output = document.getElementById('output');
let isResizingV = false;

vertResizer.addEventListener('mousedown', e => { isResizingV = true; document.body.style.cursor='row-resize'; });
document.addEventListener('mousemove', e => {
    if (!isResizingV) return;
    let containerTop = codeContainer.parentNode.getBoundingClientRect().top;
    let newHeight = e.clientY - containerTop;
    if (newHeight < 100) newHeight = 100;
    codeContainer.style.height = newHeight + 'px';
});
document.addEventListener('mouseup', e => { isResizingV = false; document.body.style.cursor='default'; });
</script>
</body>
</html>
